<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head>-->
<!--    <title>GSRæƒ…ç»ªå®æ—¶ç›‘æµ‹</title>-->
<!--    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.0/socket.io.min.js"></script>-->
<!--    <style>-->
<!--        body {-->
<!--            font-family: Arial, sans-serif;-->
<!--            margin: 20px;-->
<!--            background: #f0f2f5;-->
<!--        }-->
<!--        h1 {-->
<!--            color: #1a73e8;-->
<!--            text-align: center;-->
<!--            margin-bottom: 30px;-->
<!--        }-->
<!--        .dashboard {-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            gap: 30px;-->
<!--        }-->
<!--        #gsrChart {-->
<!--            height: 60vh;-->
<!--            min-height: 400px;-->
<!--            background: white;-->
<!--            border-radius: 12px;-->
<!--            box-shadow: 0 4px 6px rgba(0,0,0,0.1);-->
<!--            padding: 20px;-->
<!--        }-->
<!--        .emotion-panel {-->
<!--            background: white;-->
<!--            border-radius: 12px;-->
<!--            box-shadow: 0 4px 6px rgba(0,0,0,0.1);-->
<!--            padding: 30px;-->
<!--            text-align: center;-->
<!--        }-->
<!--        .emotion-display {-->
<!--            transition: all 0.3s ease;-->
<!--            font-size: 4em;-->
<!--            padding: 30px;-->
<!--            border-radius: 15px;-->
<!--            margin: 20px 0;-->
<!--            background: #f8f9fa;-->
<!--        }-->
<!--        #emotionText {-->
<!--            font-size: 1.2em;-->
<!--            color: #666;-->
<!--            margin-bottom: 10px;-->
<!--        }-->
<!--        #gsrValue {-->
<!--            font-size: 1.1em;-->
<!--            color: #888;-->
<!--        }-->

<!--&lt;!&ndash;        .history-panel {&ndash;&gt;-->
<!--&lt;!&ndash;            margin-top: 30px;&ndash;&gt;-->
<!--&lt;!&ndash;            background: white;&ndash;&gt;-->
<!--&lt;!&ndash;            border-radius: 12px;&ndash;&gt;-->
<!--&lt;!&ndash;            padding: 20px;&ndash;&gt;-->
<!--&lt;!&ndash;            box-shadow: 0 4px 6px rgba(0,0,0,0.1);&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->

<!--        .history-panel {-->
<!--            background: white;-->
<!--            border-radius: 12px;-->
<!--            padding: 20px;-->
<!--            box-shadow: 0 4px 6px rgba(0,0,0,0.1);-->
<!--        }-->
<!--        #historyTable {-->
<!--            width: 100%;-->
<!--            border-collapse: collapse;-->
<!--            margin-top: 15px;-->
<!--        }-->

<!--        #historyTable th,-->
<!--        #historyTable td {-->
<!--            padding: 12px;-->
<!--            text-align: left;-->
<!--            border-bottom: 1px solid #ddd;-->
<!--        }-->

<!--        #historyTable th {-->
<!--            background-color: #f8f9fa;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--    <h1>çš®è‚¤ç”µä¿¡å·æƒ…ç»ªå®æ—¶ç›‘æµ‹</h1>-->
<!--    <div class="dashboard">-->
<!--        <div id="gsrChart">-->
<!--            <canvas id="chart"></canvas>-->
<!--        </div>-->
<!--        <div class="emotion-panel">-->
<!--            <div class="emotion-display" id="emotionDisplay">â³</div>-->
<!--            <div id="emotionText">å½“å‰æƒ…ç»ª: ç­‰å¾…æ•°æ®...</div>-->
<!--            <div id="gsrValue">æœ€æ–°GSRå€¼: -</div>-->
<!--        </div>-->
<!--    </div>-->

<!--    <div class="history-panel">-->
<!--        <h2>æƒ…ç»ªå†å²è®°å½•</h2>-->
<!--        <table id="historyTable">-->
<!--            <thead>-->
<!--                <tr>-->
<!--                    <th>ID</th>-->
<!--                    <th>å¼€å§‹æ—¶é—´</th>-->
<!--                    <th>ç»“æŸæ—¶é—´</th>-->
<!--                    <th>æƒ…ç»ªçŠ¶æ€</th>-->
<!--                </tr>-->
<!--            </thead>-->
<!--            <tbody>-->
<!--                &lt;!&ndash; æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ &ndash;&gt;-->
<!--            </tbody>-->
<!--        </table>-->
<!--    </div>-->

<!--    <script>-->
<!--        // åˆå§‹åŒ–å›¾è¡¨-->
<!--        const ctx = document.getElementById('chart').getContext('2d');-->
<!--        const chart = new Chart(ctx, {-->
<!--            type: 'line',-->
<!--            data: {-->
<!--                labels: [],-->
<!--                datasets: [{-->
<!--                    label: 'GSRä¿¡å·',-->
<!--                    data: [],-->
<!--                    borderColor: '#2196F3',-->
<!--                    backgroundColor: 'rgba(33, 150, 243, 0.05)',-->
<!--                    borderWidth: 1.5,-->
<!--                    pointRadius: 0,-->
<!--                    fill: true-->
<!--                }]-->
<!--            },-->
<!--            options: {-->
<!--                responsive: true,-->
<!--                maintainAspectRatio: false,-->
<!--                animation: false,-->
<!--                scales: {-->
<!--                    x: {-->
<!--                        type: 'linear',-->
<!--                        title: { display: true, text: 'é‡‡æ ·ç‚¹' },-->
<!--                        grid: { display: false }-->
<!--                    },-->
<!--                    y: {-->
<!--                        title: { display: true, text: 'GSRå€¼' },-->
<!--                        grid: { color: '#eee' },-->
<!--                        grace: '30%'-->
<!--                    }-->
<!--                }-->
<!--            }-->
<!--        });-->

<!--        // è¿æ¥WebSocket-->
<!--        //const socket = io();-->
<!--        const socket = io('http://localhost:5001', {-->
<!--            transports: ['websocket'],  // ä»…ä½¿ç”¨WebSocket-->
<!--            //reconnection: false         // ç¦ç”¨è‡ªåŠ¨é‡è¿ï¼ˆè°ƒè¯•ç”¨ï¼‰-->
<!--        });-->

<!--        socket.on('connect', () => {-->
<!--            console.log("âœ… å·²è¿æ¥åˆ°æœåŠ¡å™¨");-->
<!--        });-->

<!--        // æ·»åŠ è¿æ¥é”™è¯¯ç›‘å¬ï¼ˆè°ƒè¯•ç”¨ï¼‰-->
<!--        socket.on('connect_error', (error) => {-->
<!--            console.error('âŒ è¿æ¥é”™è¯¯:', error.message);-->
<!--        });-->

<!--        socket.on('update', (data) => {-->
<!--            console.log("ğŸ“¡ æ”¶åˆ°æ•°æ®:", data);-->

<!--            // æ›´æ–°å›¾è¡¨-->
<!--            chart.data.labels = data.buffer.map((_, index) => index);-->
<!--            chart.data.datasets[0].data = data.buffer;-->

<!--            // è‡ªåŠ¨è°ƒæ•´Yè½´-->
<!--            const visibleData = data.buffer.slice(-50);-->
<!--            const minVal = Math.min(...visibleData);-->
<!--            const maxVal = Math.max(...visibleData);-->
<!--            const range = maxVal - minVal;-->
<!--            const margin = Math.max(range * 0.3, 30);-->

<!--            chart.options.scales.y.min = minVal - margin;-->
<!--            chart.options.scales.y.max = maxVal + margin;-->

<!--            chart.update();-->

<!--            // æ›´æ–°æƒ…ç»ªæ˜¾ç¤º-->
<!--            document.getElementById('emotionDisplay').textContent = data.emotion.emoji;-->
<!--            document.getElementById('emotionDisplay').style.backgroundColor = data.emotion.color;-->
<!--            document.getElementById('emotionText').textContent = `å½“å‰æƒ…ç»ª: ${data.emotion.text}`;-->
<!--            document.getElementById('gsrValue').textContent = `æœ€æ–°GSRå€¼: ${data.gsr}`;-->
<!--        });-->

<!--        socket.on('error', (msg) => {-->
<!--            console.error("âŒ é”™è¯¯:", msg);-->
<!--            alert(msg.message);-->
<!--        });-->

<!--        // ä¿®æ”¹åçš„åŠ è½½å†å²è®°å½•å‡½æ•°-->
<!--        function loadHistory() {-->
<!--            fetch('/get_records')-->
<!--                .then(response => response.json())-->
<!--                .then(data => {-->
<!--                    console.log("âœ… æ¥æ”¶åˆ°çš„æ•°æ®:", data);-->
<!--                    const tbody = document.querySelector('#historyTable tbody');-->
<!--                    tbody.innerHTML = data.map(record => `-->
<!--                        <tr>-->
<!--                            <td>${record.id}</td>-->
<!--                            <td>${record.start}</td>-->
<!--                            <td>${record.end}</td>-->
<!--                            <td>${unescape(JSON.parse('"' + record.emotion.replace(/\"/g, '\\"') + '"'))}</td>-->
<!--                        </tr>-->
<!--                    `).join('');-->
<!--                })-->
<!--                .catch(error => console.error("âŒ åŠ è½½å†å²è®°å½•å¤±è´¥:", error));-->
<!--        }-->

<!--        // ç¡®ä¿é¦–æ¬¡åŠ è½½å’Œå®šæ—¶åˆ·æ–°-->
<!--        document.addEventListener('DOMContentLoaded', function() {-->
<!--            loadHistory();-->
<!--            setInterval(loadHistory, 3000);-->
<!--        });-->
<!--    </script>-->
<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html>
<head>
    <title>GSRæƒ…ç»ªå®æ—¶ç›‘æµ‹</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.0/socket.io.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f2f5;
        }
        h1 {
            color: #1a73e8;
            text-align: center;
            margin-bottom: 30px;
        }
        .dashboard {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        #gsrChart {
            height: 60vh;
            min-height: 400px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 20px;
        }
        .emotion-panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 30px;
            text-align: center;
        }
        .emotion-display {
            transition: all 0.3s ease;
            font-size: 4em;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            background: #f8f9fa;
        }
        #emotionText {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 10px;
        }
        #gsrValue {
            font-size: 1.1em;
            color: #888;
        }
<!--        .history-panel {-->
<!--            background: white;-->
<!--            border-radius: 12px;-->
<!--            padding: 20px;-->
<!--            box-shadow: 0 4px 6px rgba(0,0,0,0.1);-->
<!--        }-->
        .history-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: block !important; /* å¼ºåˆ¶æ˜¾ç¤º */
            opacity: 1 !important; /* å¼ºåˆ¶ä¸é€æ˜ */
            height: auto !important; /* é«˜åº¦è‡ªé€‚åº” */
        }
        #historyTable {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        #historyTable th,
        #historyTable td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        #historyTable th {
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <h1>çš®è‚¤ç”µä¿¡å·æƒ…ç»ªå®æ—¶ç›‘æµ‹</h1>
    <div class="dashboard">
        <div id="gsrChart">
            <canvas id="chart"></canvas>
        </div>
        <div class="emotion-panel">
            <div class="emotion-display" id="emotionDisplay">â³</div>
            <div id="emotionText">å½“å‰æƒ…ç»ª: ç­‰å¾…æ•°æ®...</div>
            <div id="gsrValue">æœ€æ–°GSRå€¼: -</div>
        </div>
        <div class="history-panel">
            <h2>æƒ…ç»ªå†å²è®°å½•</h2>
            <table id="historyTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>å¼€å§‹æ—¶é—´</th>
                        <th>ç»“æŸæ—¶é—´</th>
                        <th>æƒ…ç»ªçŠ¶æ€</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–å›¾è¡¨
        const ctx = document.getElementById('chart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'GSRä¿¡å·',
                    data: [],
                    borderColor: '#2196F3',
                    backgroundColor: 'rgba(33, 150, 243, 0.05)',
                    borderWidth: 1.5,
                    pointRadius: 0,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                scales: {
                    x: {
                        type: 'linear',
                        title: { display: true, text: 'é‡‡æ ·ç‚¹' },
                        grid: { display: false }
                    },
                    y: {
                        title: { display: true, text: 'GSRå€¼' },
                        grid: { color: '#eee' },
                        grace: '30%'
                    }
                }
            }
        });

        // è¿æ¥WebSocket
        const socket = io('http://localhost:5001', {
            transports: ['websocket']
        });

        socket.on('connect', () => {
            console.log("âœ… å·²è¿æ¥åˆ°æœåŠ¡å™¨");
        });

        socket.on('connect_error', (error) => {
            console.error('âŒ è¿æ¥é”™è¯¯:', error.message);
        });

        socket.on('update', (data) => {
            console.log("ğŸ“¡ æ”¶åˆ°æ•°æ®:", data);
            chart.data.labels = data.buffer.map((_, index) => index);
            chart.data.datasets[0].data = data.buffer;
            const visibleData = data.buffer.slice(-50);
            const minVal = Math.min(...visibleData);
            const maxVal = Math.max(...visibleData);
            const range = maxVal - minVal;
            const margin = Math.max(range * 0.3, 30);
            chart.options.scales.y.min = minVal - margin;
            chart.options.scales.y.max = maxVal + margin;
            chart.update();
            document.getElementById('emotionDisplay').textContent = data.emotion.emoji;
            document.getElementById('emotionDisplay').style.backgroundColor = data.emotion.color;
            document.getElementById('emotionText').textContent = `å½“å‰æƒ…ç»ª: ${data.emotion.text}`;
            document.getElementById('gsrValue').textContent = `æœ€æ–°GSRå€¼: ${data.gsr}`;
        });

        socket.on('error', (msg) => {
            console.error("âŒ é”™è¯¯:", msg);
            alert(msg.message);
        });

        function loadHistory() {
            fetch('/get_records')
                .then(response => response.json())
                .then(data => {
                    console.log("âœ… æ¥æ”¶åˆ°çš„æ•°æ®:", data);
                    const tbody = document.querySelector('#historyTable tbody');
                    tbody.innerHTML = data.map(record => `
                        <tr>
                            <td>${record.id}</td>
                            <td>${record.start}</td>
                            <td>${record.end}</td>
                            <td>${record.emotion}</td>
                        </tr>
                    `).join('');
                })
                .catch(error => console.error("âŒ åŠ è½½å†å²è®°å½•å¤±è´¥:", error));
        }

        // ç¡®ä¿é¦–æ¬¡åŠ è½½å’Œå®šæ—¶åˆ·æ–°
        document.addEventListener('DOMContentLoaded', function() {
            loadHistory();
            setInterval(loadHistory, 3000);
        });
    </script>
</body>
</html>